@model SearchModel
@{
    var submissionDeadlineFromErrors = new {
        Day = ViewData.ModelState["SearchParams.SubmissionDeadlineFromDay"]?.Errors.FirstOrDefault()?.ErrorMessage,
        Month = ViewData.ModelState["SearchParams.SubmissionDeadlineFromMonth"]?.Errors.FirstOrDefault()?.ErrorMessage,
        Year = ViewData.ModelState["SearchParams.SubmissionDeadlineFromYear"]?.Errors.FirstOrDefault()?.ErrorMessage
    };

    var submissionDeadlineToErrors = new {
        Day = ViewData.ModelState["SearchParams.SubmissionDeadlineToDay"]?.Errors.FirstOrDefault()?.ErrorMessage,
        Month = ViewData.ModelState["SearchParams.SubmissionDeadlineToMonth"]?.Errors.FirstOrDefault()?.ErrorMessage,
        Year = ViewData.ModelState["SearchParams.SubmissionDeadlineToYear"]?.Errors.FirstOrDefault()?.ErrorMessage
    };

    var contractStartDateFromErrors = new {
        Day = ViewData.ModelState["SearchParams.ContractStartDateFromDay"]?.Errors.FirstOrDefault()?.ErrorMessage,
        Month = ViewData.ModelState["SearchParams.ContractStartDateFromMonth"]?.Errors.FirstOrDefault()?.ErrorMessage,
        Year = ViewData.ModelState["SearchParams.ContractStartDateFromYear"]?.Errors.FirstOrDefault()?.ErrorMessage
    };

    var contractStartDateToErrors = new {
        Day = ViewData.ModelState["SearchParams.ContractStartDateToDay"]?.Errors.FirstOrDefault()?.ErrorMessage,
        Month = ViewData.ModelState["SearchParams.ContractStartDateToMonth"]?.Errors.FirstOrDefault()?.ErrorMessage,
        Year = ViewData.ModelState["SearchParams.ContractStartDateToYear"]?.Errors.FirstOrDefault()?.ErrorMessage
    };

    var contractEndDateFromErrors = new {
        Day = ViewData.ModelState["SearchParams.ContractEndDateFromDay"]?.Errors.FirstOrDefault()?.ErrorMessage,
        Month = ViewData.ModelState["SearchParams.ContractEndDateFromMonth"]?.Errors.FirstOrDefault()?.ErrorMessage,
        Year = ViewData.ModelState["SearchParams.ContractEndDateFromYear"]?.Errors.FirstOrDefault()?.ErrorMessage
    };

    var contractEndDateToErrors = new {
        Day = ViewData.ModelState["SearchParams.ContractEndDateToDay"]?.Errors.FirstOrDefault()?.ErrorMessage,
        Month = ViewData.ModelState["SearchParams.ContractEndDateToMonth"]?.Errors.FirstOrDefault()?.ErrorMessage,
        Year = ViewData.ModelState["SearchParams.ContractEndDateToYear"]?.Errors.FirstOrDefault()?.ErrorMessage
    };

    bool HasDateErrors(dynamic errors) => !string.IsNullOrEmpty(errors.Day) || !string.IsNullOrEmpty(errors.Month) || !string.IsNullOrEmpty(errors.Year);

    string GetFirstError(dynamic errors) => errors.Day ?? errors.Month ?? errors.Year ?? "";
}

<div class="govuk-!-margin-top-0">
    <p class="govuk-body-s govuk-!-padding-left-2">Commercial tools which were active or expired within a date range
        (searches submission deadline, contract start/end date, open framework end date and start/end date of the
        DM)</p>

    <details class="govuk-details accordion-highlight govuk-!-padding-2 govuk-!-margin-left-2 govuk-!-margin-right-4"
             data-module="govuk-details">
        <summary class="govuk-details__summary">
            <span class="govuk-details__summary-text govuk-!-font-size-14">
                Submission deadline
            </span>
        </summary>
        <div class="govuk-details__text govuk-!-padding-0 no-border">
            <div class="govuk-form-group @(HasDateErrors(submissionDeadlineFromErrors) ? "govuk-form-group--error" : "") govuk-!-margin-bottom-0">
                <fieldset class="govuk-fieldset govuk-!-margin-bottom-4" role="group" aria-describedby="submission-deadline-from-hint @(HasDateErrors(submissionDeadlineFromErrors) ? "submission-deadline-from-error" : "")">
                    <legend class="govuk-fieldset__legend govuk-!-font-size-16">
                        From
                    </legend>
                    <div id="submission-deadline-from-hint"
                         class="govuk-hint govuk-!-font-size-16 govuk-!-margin-bottom-2">
                        For example, 25 05 2025
                    </div>
                    @if (HasDateErrors(submissionDeadlineFromErrors))
                    {
                        <p id="submission-deadline-from-error" class="govuk-error-message">
                            <span class="govuk-visually-hidden">Error:</span> @GetFirstError(submissionDeadlineFromErrors)
                        </p>
                    }
                    <div class="govuk-date-input @(HasDateErrors(submissionDeadlineFromErrors) ? "govuk-date-input--error" : "")" id="submission-deadline-from">
                        <div class="govuk-date-input__item govuk-!-margin-right-3">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.SubmissionDeadlineFromDay">
                                    Day
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2 @(!string.IsNullOrEmpty(submissionDeadlineFromErrors.Day) ? "govuk-input--error" : "")"
                                       id="SearchParams.SubmissionDeadlineFromDay"
                                       name="SearchParams.SubmissionDeadlineFromDay"
                                       type="text" inputmode="numeric"
                                       value="@Model.SubmissionDeadlineFromDay">
                            </div>
                        </div>
                        <div class="govuk-date-input__item govuk-!-margin-right-3">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.SubmissionDeadlineFromMonth">
                                    Month
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2 @(!string.IsNullOrEmpty(submissionDeadlineFromErrors.Month) ? "govuk-input--error" : "")"
                                       id="SearchParams.SubmissionDeadlineFromMonth"
                                       name="SearchParams.SubmissionDeadlineFromMonth"
                                       type="text" inputmode="numeric"
                                       value="@Model.SubmissionDeadlineFromMonth">
                            </div>
                        </div>
                        <div class="govuk-date-input__item">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.SubmissionDeadlineFromYear">
                                    Year
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-4 @(!string.IsNullOrEmpty(submissionDeadlineFromErrors.Year) ? "govuk-input--error" : "")"
                                       id="SearchParams.SubmissionDeadlineFromYear"
                                       name="SearchParams.SubmissionDeadlineFromYear"
                                       type="text" inputmode="numeric"
                                       value="@Model.SubmissionDeadlineFromYear">
                            </div>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="govuk-fieldset" role="group" aria-describedby="submission-deadline-to-hint @(HasDateErrors(submissionDeadlineToErrors) ? "submission-deadline-to-error" : "")">
                    <legend class="govuk-fieldset__legend govuk-!-font-size-16 govuk-!-margin-bottom-2">
                        To
                    </legend>
                    <div id="submission-deadline-to-hint" class="govuk-hint govuk-!-font-size-16 govuk-!-margin-bottom-2">
                        For example, 25 05 2025
                    </div>
                    @if (HasDateErrors(submissionDeadlineToErrors))
                    {
                        <p id="submission-deadline-to-error" class="govuk-error-message">
                            <span class="govuk-visually-hidden">Error:</span> @GetFirstError(submissionDeadlineToErrors)
                        </p>
                    }
                    <div class="govuk-date-input @(HasDateErrors(submissionDeadlineToErrors) ? "govuk-date-input--error" : "")" id="submission-deadline-to">
                        <div class="govuk-date-input__item govuk-!-margin-right-3">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.SubmissionDeadlineToDay">
                                    Day
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2 @(!string.IsNullOrEmpty(submissionDeadlineToErrors.Day) ? "govuk-input--error" : "")"
                                       id="SearchParams.SubmissionDeadlineToDay"
                                       name="SearchParams.SubmissionDeadlineToDay"
                                       type="text" inputmode="numeric"
                                       value="@Model.SubmissionDeadlineToDay">
                            </div>
                        </div>
                        <div class="govuk-date-input__item govuk-!-margin-right-3">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.SubmissionDeadlineToMonth">
                                    Month
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2 @(!string.IsNullOrEmpty(submissionDeadlineToErrors.Month) ? "govuk-input--error" : "")"
                                       id="SearchParams.SubmissionDeadlineToMonth"
                                       name="SearchParams.SubmissionDeadlineToMonth"
                                       type="text" inputmode="numeric"
                                       value="@Model.SubmissionDeadlineToMonth">
                            </div>
                        </div>
                        <div class="govuk-date-input__item">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.SubmissionDeadlineToYear">
                                    Year
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-4 @(!string.IsNullOrEmpty(submissionDeadlineToErrors.Year) ? "govuk-input--error" : "")"
                                       id="SearchParams.SubmissionDeadlineToYear"
                                       name="SearchParams.SubmissionDeadlineToYear"
                                       type="text" inputmode="numeric"
                                       value="@Model.SubmissionDeadlineToYear">
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
    </details>

    <details class="govuk-details accordion-highlight govuk-!-padding-2 govuk-!-margin-left-2 govuk-!-margin-right-4"
             data-module="govuk-details">
        <summary class="govuk-details__summary">
            <span class="govuk-details__summary-text govuk-!-font-size-14">
                Contract start date
            </span>
        </summary>
        <div class="govuk-details__text govuk-!-padding-0 no-border">
            <div class="govuk-form-group @(HasDateErrors(contractStartDateFromErrors) ? "govuk-form-group--error" : "") govuk-!-margin-bottom-0">
                <fieldset class="govuk-fieldset govuk-!-margin-bottom-4" role="group" aria-describedby="contract-start-date-from-hint @(HasDateErrors(contractStartDateFromErrors) ? "contract-start-date-from-error" : "")">
                    <legend class="govuk-fieldset__legend govuk-!-font-size-16">
                        From
                    </legend>
                    <div id="contract-start-date-from-hint"
                         class="govuk-hint govuk-!-font-size-16 govuk-!-margin-bottom-2">
                        For example, 25 05 2025
                    </div>
                    @if (HasDateErrors(contractStartDateFromErrors))
                    {
                        <p id="contract-start-date-from-error" class="govuk-error-message">
                            <span class="govuk-visually-hidden">Error:</span> @GetFirstError(contractStartDateFromErrors)
                        </p>
                    }
                    <div class="govuk-date-input @(HasDateErrors(contractStartDateFromErrors) ? "govuk-date-input--error" : "")" id="contract-start-date-from">
                        <div class="govuk-date-input__item govuk-!-margin-right-3">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.ContractStartDateFromDay">
                                    Day
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2 @(!string.IsNullOrEmpty(contractStartDateFromErrors.Day) ? "govuk-input--error" : "")"
                                       id="SearchParams.ContractStartDateFromDay"
                                       name="SearchParams.ContractStartDateFromDay"
                                       type="text" inputmode="numeric"
                                       value="@Model.ContractStartDateFromDay">
                            </div>
                        </div>
                        <div class="govuk-date-input__item govuk-!-margin-right-3">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.ContractStartDateFromMonth">
                                    Month
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2 @(!string.IsNullOrEmpty(contractStartDateFromErrors.Month) ? "govuk-input--error" : "")"
                                       id="SearchParams.ContractStartDateFromMonth"
                                       name="SearchParams.ContractStartDateFromMonth"
                                       type="text" inputmode="numeric"
                                       value="@Model.ContractStartDateFromMonth">
                            </div>
                        </div>
                        <div class="govuk-date-input__item">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.ContractStartDateFromYear">
                                    Year
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-4 @(!string.IsNullOrEmpty(contractStartDateFromErrors.Year) ? "govuk-input--error" : "")"
                                       id="SearchParams.ContractStartDateFromYear"
                                       name="SearchParams.ContractStartDateFromYear"
                                       type="text" inputmode="numeric"
                                       value="@Model.ContractStartDateFromYear">
                            </div>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="govuk-fieldset" role="group" aria-describedby="contract-start-date-to-hint @(HasDateErrors(contractStartDateToErrors) ? "contract-start-date-to-error" : "")">
                    <legend class="govuk-fieldset__legend govuk-!-font-size-16 govuk-!-margin-bottom-2">
                        To
                    </legend>
                    <div id="contract-start-date-to-hint" class="govuk-hint govuk-!-font-size-16 govuk-!-margin-bottom-2">
                        For example, 25 05 2025
                    </div>
                    @if (HasDateErrors(contractStartDateToErrors))
                    {
                        <p id="contract-start-date-to-error" class="govuk-error-message">
                            <span class="govuk-visually-hidden">Error:</span> @GetFirstError(contractStartDateToErrors)
                        </p>
                    }
                    <div class="govuk-date-input @(HasDateErrors(contractStartDateToErrors) ? "govuk-date-input--error" : "")" id="contract-start-date-to">
                        <div class="govuk-date-input__item govuk-!-margin-right-3">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.ContractStartDateToDay">
                                    Day
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2 @(!string.IsNullOrEmpty(contractStartDateToErrors.Day) ? "govuk-input--error" : "")"
                                       id="SearchParams.ContractStartDateToDay"
                                       name="SearchParams.ContractStartDateToDay"
                                       type="text" inputmode="numeric"
                                       value="@Model.ContractStartDateToDay">
                            </div>
                        </div>
                        <div class="govuk-date-input__item govuk-!-margin-right-3">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.ContractStartDateToMonth">
                                    Month
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2 @(!string.IsNullOrEmpty(contractStartDateToErrors.Month) ? "govuk-input--error" : "")"
                                       id="SearchParams.ContractStartDateToMonth"
                                       name="SearchParams.ContractStartDateToMonth"
                                       type="text" inputmode="numeric"
                                       value="@Model.ContractStartDateToMonth">
                            </div>
                        </div>
                        <div class="govuk-date-input__item">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.ContractStartDateToYear">
                                    Year
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-4 @(!string.IsNullOrEmpty(contractStartDateToErrors.Year) ? "govuk-input--error" : "")"
                                       id="SearchParams.ContractStartDateToYear"
                                       name="SearchParams.ContractStartDateToYear"
                                       type="text" inputmode="numeric"
                                       value="@Model.ContractStartDateToYear">
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
    </details>

    <details class="govuk-details accordion-highlight govuk-!-padding-2 govuk-!-margin-left-2 govuk-!-margin-right-4"
             data-module="govuk-details">
        <summary class="govuk-details__summary">
            <span class="govuk-details__summary-text govuk-!-font-size-14">
                Contract end date
            </span>
        </summary>
        <div class="govuk-details__text govuk-!-padding-0 no-border">
            <div class="govuk-form-group @(HasDateErrors(contractEndDateFromErrors) ? "govuk-form-group--error" : "") govuk-!-margin-bottom-0">
                <fieldset class="govuk-fieldset govuk-!-margin-bottom-4" role="group" aria-describedby="contract-end-date-from-hint @(HasDateErrors(contractEndDateFromErrors) ? "contract-end-date-from-error" : "")">
                    <legend class="govuk-fieldset__legend govuk-!-font-size-16">
                        From
                    </legend>
                    <div id="contract-end-date-from-hint"
                         class="govuk-hint govuk-!-font-size-16 govuk-!-margin-bottom-2">
                        For example, 25 05 2025
                    </div>
                    @if (HasDateErrors(contractEndDateFromErrors))
                    {
                        <p id="contract-end-date-from-error" class="govuk-error-message">
                            <span class="govuk-visually-hidden">Error:</span> @GetFirstError(contractEndDateFromErrors)
                        </p>
                    }
                    <div class="govuk-date-input @(HasDateErrors(contractEndDateFromErrors) ? "govuk-date-input--error" : "")" id="contract-end-date-from">
                        <div class="govuk-date-input__item govuk-!-margin-right-3">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.ContractEndDateFromDay">
                                    Day
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2 @(!string.IsNullOrEmpty(contractEndDateFromErrors.Day) ? "govuk-input--error" : "")"
                                       id="SearchParams.ContractEndDateFromDay"
                                       name="SearchParams.ContractEndDateFromDay"
                                       type="text" inputmode="numeric"
                                       value="@Model.ContractEndDateFromDay">
                            </div>
                        </div>
                        <div class="govuk-date-input__item govuk-!-margin-right-3">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.ContractEndDateFromMonth">
                                    Month
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2 @(!string.IsNullOrEmpty(contractEndDateFromErrors.Month) ? "govuk-input--error" : "")"
                                       id="SearchParams.ContractEndDateFromMonth"
                                       name="SearchParams.ContractEndDateFromMonth"
                                       type="text" inputmode="numeric"
                                       value="@Model.ContractEndDateFromMonth">
                            </div>
                        </div>
                        <div class="govuk-date-input__item">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.ContractEndDateFromYear">
                                    Year
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-4 @(!string.IsNullOrEmpty(contractEndDateFromErrors.Year) ? "govuk-input--error" : "")"
                                       id="SearchParams.ContractEndDateFromYear"
                                       name="SearchParams.ContractEndDateFromYear"
                                       type="text" inputmode="numeric"
                                       value="@Model.ContractEndDateFromYear">
                            </div>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="govuk-fieldset" role="group" aria-describedby="contract-end-date-to-hint @(HasDateErrors(contractEndDateToErrors) ? "contract-end-date-to-error" : "")">
                    <legend class="govuk-fieldset__legend govuk-!-font-size-16 govuk-!-margin-bottom-2">
                        To
                    </legend>
                    <div id="contract-end-date-to-hint" class="govuk-hint govuk-!-font-size-16 govuk-!-margin-bottom-2">
                        For example, 25 05 2025
                    </div>
                    @if (HasDateErrors(contractEndDateToErrors))
                    {
                        <p id="contract-end-date-to-error" class="govuk-error-message">
                            <span class="govuk-visually-hidden">Error:</span> @GetFirstError(contractEndDateToErrors)
                        </p>
                    }
                    <div class="govuk-date-input @(HasDateErrors(contractEndDateToErrors) ? "govuk-date-input--error" : "")" id="contract-end-date-to">
                        <div class="govuk-date-input__item govuk-!-margin-right-3">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.ContractEndDateToDay">
                                    Day
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2 @(!string.IsNullOrEmpty(contractEndDateToErrors.Day) ? "govuk-input--error" : "")"
                                       id="SearchParams.ContractEndDateToDay"
                                       name="SearchParams.ContractEndDateToDay"
                                       type="text" inputmode="numeric"
                                       value="@Model.ContractEndDateToDay">
                            </div>
                        </div>
                        <div class="govuk-date-input__item govuk-!-margin-right-3">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.ContractEndDateToMonth">
                                    Month
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2 @(!string.IsNullOrEmpty(contractEndDateToErrors.Month) ? "govuk-input--error" : "")"
                                       id="SearchParams.ContractEndDateToMonth"
                                       name="SearchParams.ContractEndDateToMonth"
                                       type="text" inputmode="numeric"
                                       value="@Model.ContractEndDateToMonth">
                            </div>
                        </div>
                        <div class="govuk-date-input__item">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label govuk-!-font-size-16"
                                       for="SearchParams.ContractEndDateToYear">
                                    Year
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-4 @(!string.IsNullOrEmpty(contractEndDateToErrors.Year) ? "govuk-input--error" : "")"
                                       id="SearchParams.ContractEndDateToYear"
                                       name="SearchParams.ContractEndDateToYear"
                                       type="text" inputmode="numeric"
                                       value="@Model.ContractEndDateToYear">
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
    </details>
</div>