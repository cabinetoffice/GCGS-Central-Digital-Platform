@using CO.CDP.RegisterOfCommercialTools.App.Models
@model CpvTreeNodeViewModel

@if (Model.HasChildren)
{
    <details class="code-details code-details--level-@Model.Level" data-cpv-code="@Model.Item.Code">
        <summary class="code-details__summary">
            <input class="govuk-checkboxes__input govuk-checkboxes__input--small code-details__checkbox"
                   type="checkbox"
                   id="@Model.CheckboxId"
                   data-code="@Model.Item.Code"
                   data-parent-code="@Model.Item.ParentCode"
                   data-level="@Model.Item.Level"
                   data-action="toggle-selection"
                   @(Model.IsSelected || Model.IsDisabled ? "checked" : "")
                   @(Model.IsDisabled ? "disabled" : "")>
            <span class="code-details__content">
                <span class="govuk-body-s"><strong>@Model.Item.Code</strong> @Model.Item.DescriptionEn</span>
            </span>
        </summary>

        <div class="code-details__children" data-children-container="@Model.Item.Code">
            @if (Model.Item.Children.Any())
            {
                @foreach (var child in Model.Item.Children)
                {
                    @await Html.PartialAsync("_CpvTreeNode", new CpvTreeNodeViewModel { Item = child, Level = Model.Level + 1, SelectedCodes = Model.SelectedCodes })
                }
            }
        </div>
    </details>
}
else
{
    <div class="code-item code-item--level-@Model.Level">
        <div class="code-item__content">
            <input class="govuk-checkboxes__input govuk-checkboxes__input--small code-item__checkbox"
                   type="checkbox"
                   id="@Model.CheckboxId"
                   data-code="@Model.Item.Code"
                   data-parent-code="@Model.Item.ParentCode"
                   data-level="@Model.Item.Level"
                   data-action="toggle-selection"
                   @(Model.IsSelected || Model.IsDisabled ? "checked" : "")
                   @(Model.IsDisabled ? "disabled" : "")>
            <span class="code-item__text">
                <span class="govuk-body-s"><strong>@Model.Item.Code</strong> @Model.Item.DescriptionEn</span>
            </span>
        </div>
    </div>
}