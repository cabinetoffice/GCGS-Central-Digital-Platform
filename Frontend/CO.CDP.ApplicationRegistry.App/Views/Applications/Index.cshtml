@model CO.CDP.ApplicationRegistry.App.Models.ApplicationsViewModel
@{
    ViewData["Title"] = "Available applications";
    var organisationSlug = ViewContext.RouteData.Values["organisationSlug"]?.ToString() ?? "";
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <span class="govuk-caption-xl">@Model.OrganisationName</span>
        <h1 class="govuk-heading-xl">Available applications</h1>
        <p class="govuk-body-l">Enable applications for your organisation to allow users to be assigned access.</p>
    </div>
</div>

<form method="get" aria-label="Search and filter applications" class="app-filter-container">
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-one-quarter">
            <div class="govuk-form-group filter-dropdown-wrapper">
                <label class="govuk-label govuk-!-font-weight-bold" for="category-filter">
                    Filter by category
                </label>
                <select class="govuk-select" id="category-filter" name="category">
                    <option value="">All categories</option>
                    @foreach (var cat in Model.Categories)
                    {
                        <option value="@cat" selected="@(cat == Model.SelectedCategory)">@cat</option>
                    }
                </select>
            </div>
        </div>
        <div class="govuk-grid-column-one-quarter">
            <div class="govuk-form-group filter-dropdown-wrapper">
                <label class="govuk-label govuk-!-font-weight-bold" for="status-filter">
                    Filter by status
                </label>
                <select class="govuk-select" id="status-filter" name="status">
                    <option value="">All statuses</option>
                    <option value="enabled" selected="@(Model.SelectedStatus == "enabled")">Enabled</option>
                    <option value="available" selected="@(Model.SelectedStatus == "available")">Available to enable</option>
                </select>
            </div>
        </div>
        <div class="govuk-grid-column-one-half">
            <div class="govuk-form-group">
                <label class="govuk-label govuk-!-font-weight-bold" for="application-search">
                    Search applications
                </label>
                <div class="search-flex-display">
                    <input class="govuk-input search-text-input"
                           id="application-search"
                           name="search"
                           type="text"
                           placeholder="e.g. registration">

                    <button type="submit" class="govuk-button search-button govuk-!-width-auto" data-module="govuk-button" id="search-button">
                        <span class="govuk-visually-hidden">Search</span>
                        <svg class="gem-c-search__icon" width="18" height="18" viewBox="0 0 27 27" fill="none"
                             xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                            <circle cx="12.0161" cy="11.0161" r="8.51613" stroke="currentColor" stroke-width="3"></circle>
                            <line x1="17.8668" y1="17.3587" x2="26.4475" y2="25.9393" stroke="currentColor"
                                  stroke-width="3"></line>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>

@if (Model.TotalCount == 0)
{
    <div class="govuk-inset-text">
        <p>No applications found.</p>
        <p>Try:</p>
        <ul class="govuk-list govuk-list--bullet">
            <li>checking your spelling</li>
            <li>using different search terms</li>
            @if (!string.IsNullOrEmpty(Model.SelectedCategory) || !string.IsNullOrEmpty(Model.SelectedStatus))
            {
                <li><a href="?organisationSlug=@organisationSlug" class="govuk-link">clearing the filters</a></li>
            }
        </ul>
    </div>
}
else
{
    <p class="govuk-body">Showing @Model.TotalCount applications</p>
}

@section Scripts {
    <script nonce-csp>
        document.addEventListener('DOMContentLoaded', function() {
            const categoryFilter = document.getElementById('category-filter');
            const statusFilter = document.getElementById('status-filter');
            const form = document.querySelector('.app-filter-container');

            function submitOnChange() {
                form.submit();
            }

            if (categoryFilter) categoryFilter.addEventListener('change', submitOnChange);
            if (statusFilter) statusFilter.addEventListener('change', submitOnChange);
        });
    </script>
}